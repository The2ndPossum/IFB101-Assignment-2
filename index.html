<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>
			IFB101
		</title>
	</head>
	<body>
		<h1>IFB101</h1>
		Search by keyword: <input type="text" id="wordInput"><br>
		Search by date between <input type="date" id="firstDate"> and <input type="date" id="lastDate"><br>
		<input type="checkbox" id="excludePrivate"> Exclude posts which are set to private<br>
		<input type="checkbox" id="dateCheck"> Search by date<br>
		<button id="searchButton">Submit</button><br>
		If you don't want to search by word, leave the search box empty<br>
		<div id="status"></div>
		<script>
			var postList = null;
			function statusChangeCallback(response) {
			    console.log(response);
			    if (response.status === 'connected') {
			      getPosts(response);
			    } else {
			      document.getElementById('status').innerHTML = 'Please log ' +
			        'into this app.';
			    }
			}

			function checkLogin() {
				FB.getLoginStatus(function(response) {
    				statusChangeCallback(response);
				});
			}

			function getPosts(response) {
				FB.api(
						'/me',
						{"fields":"posts{privacy,picture,created_time,message}"},
						function (response) {
							if (response && !response.error) {
								console.log(response);
								postList = response;
							} else {
								console.log(response);
							}
						}
					);
			}

			function fbAsyncInit(user_token) {
			    FB.init({
			      appId            : '863421973860747',
			      cookie           : true,
			      autoLogAppEvents : true,
			      xfbml            : true,
			      version          : 'v3.0'
			    });
			    checkLogin();
			};

			(function(d, s, id){
			    var js, fjs = d.getElementsByTagName(s)[0];
			    if (d.getElementById(id)) {return;}
			    js = d.createElement(s); js.id = id;
			    js.src = "https://connect.facebook.net/en_US/sdk.js";
			    fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));

			document.getElementById("searchButton").onclick = function() {
				var word = document.getElementById("wordInput").value;
				var excludePrivate = document.getElementById("excludePrivate").checked;
				var firstDate = document.getElementById("firstDate").value;
				var lastDate = document.getElementById("lastDate").value;
				var dateChecked = document.getElementById("dateChecked").checked;
				console.log(excludePrivate);
				console.log(firstDate);
				console.log(lastDate);
				console.log(dateChecked);
				var postData = postList.posts.data;
				var positiveList = [];
				var wordList = [];
				var dateList = [];
				if (postList !== null) {
					if (word !== "") {
						for (var i = 0; i < postData.length; i++) {
							if (typeof postList.posts.data[i].message !== 'undefined') {
									if (postList.posts.data[i].message.search(word) !== -1) {
										wordList.push(postList.posts.data[i]);
									}
							}
						}
						console.log(wordList);
					}
					if (dateChecked == True) {
						console.log("worked");
					}
				} else {
					console.log("Please wait for the page to load");
				}
			}
		</script>
	</body>
</html>
